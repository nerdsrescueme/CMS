(function(a,b){String.prototype.despace=function(){return this.split(" ").join("")};String.prototype.untitleize=function(){return this.charAt(0).toLowerCase()+this.slice(1)};String.prototype.titleize=function(){return this.charAt(0).toUpperCase()+this.slice(1)};Array.prototype.contains=function(a){var b=this.length;while(b--){if(this[b]===a)return true}return false};b.extend(b,{sanitize:function(a){var c=Nerd.html.tags,d=Nerd.html.attributes;b(a).children().each(function(a,e){b.sanitize(e);var f=e.localName.toLowerCase();if(b.inArray(f,c)<0){b(e).contents().each(function(a,c){b(c).remove().insertBefore(e)});b(e).remove()}else{b.each(e.attributes,function(){var a=this.localName;if(b.inArray(a,d[f])<0){e.removeAttribute(a)}})}});return b(a).html()}});b.extend(b,{selection:function(){return Nerd.Frame.document.getSelection()}});b.extend(b,{range:function(){return b.selection().getRangeAt(0)}});b.extend(a.Nerd,{regions:[],Commands:{},Frame:{},Editor:{},Modal:{},Panel:{}});var c=Nerd.Editor,d=Nerd.Frame,e=Nerd.Commands,f=Nerd.Modal,g=Nerd.Panel;Nerd.trigger=function(a,b){try{this[a](b)}catch(c){var d=a.split(":");this[d[0].titleize()][d[1]](b)}};c.has_changes=false;c.is_activated=false;c.activate=function(){this.style=b("<style>").text('[contenteditable="true"] { box-shadow: 0 0 8px lightblue; }').appendTo(d.head);c.toolbar.slideDown();Nerd.regions.attr("contentEditable","true");c.is_activated=true};c.deactivate=function(){this.style.remove();c.toolbar.slideDown();Nerd.regions.attr("contentEditable","false");this.hide();c.is_activated=false};c.hide=function(){c.toolbar.slideUp()};c.show=function(){c.toolbar.slideDown()};c.edit_state=false;c.edited=function(a){if(typeof a!="undefined"){c.edit_state=a}return c.edit_state};c.initialize=function(){var a=b("head").html(),h=b("#nerd-toolbar").detach(),i=b("#nerd-trigger").detach(),j=b("body").html(),k=b("body").html("").prepend(h),l=b("#nerd-buttons"),m=b('<iframe src="about:blank" id="nerd-frame">').appendTo(k),k=m.contents().find("body").html(j),n=m.contents().find("head").html(a),o=m[0].contentDocument,p=Nerd.buttons,q=p.length,r=[1,13,37,38,39,40];i.appendTo("body").click(function(a){return c.is_activated?c.deactivate():c.activate()});b("a",k).attr("target","_top").click(function(a){if(c.is_activated)return false;if(c.edited()){return confirm("Are you sure you want to leave this page? You will lose any unsaved changes.")}});h.on("click","[data-function]",function(a){a.preventDefault();var c=b(this),d=c.data("function");if(c.hasClass("active"))return;b("#nerd-tools .active").removeClass("active");c.addClass("active");switch(d){case"command":e[c.data("command")]();break;case"modal":f.load(c.attr("href"));break;case"panel":g.load(c.attr("href"));break;default:alert("Invalid command")}});b("[title]",l).tooltip({placement:"bottom",delay:500});Nerd.regions=k.find("[data-editable]");c.buttons=l;c.document=o;c.toolbar=h;d.instance=m;d.body=k;d.document=o;d.head=n;b(d.document).bind("paste",function(a){a.preventDefault();var c=a.originalEvent.clipboardData,d=b("<div>").html(c.getData("text/html")),d=b.sanitize(d);e.exec("insertHTML",false,d)});Nerd.regions.on("keydown mouseup",function(a){var d=a.which;c.edited(true);if(d===1){c.focused=this}if(r.contains(d)){c.selection=b.selection()}});Nerd.Editor=this;Nerd.Frame=d;Nerd.Commands=e;Nerd.Modal=f.initialize();Nerd.Panel=g.initialize()};f.initialize=function(){return Nerd.Frame.body.find("#nerd-modal").detach().appendTo("body").modal({show:false})};f.show=function(){b("#nerd-modal").modal("show")};f.hide=function(){b("#nerd-modal").modal("hide")};f.load=function(a){var c=b("#nerd-modal");console.log("Loading: "+a);this.show()};g.initialize=function(){return Nerd.Frame.body.find("#nerd-panel").detach().appendTo("body").modal({backdrop:false,show:false})};g.show=function(){b("#nerd-panel").modal("show")};g.hide=function(){b("#nerd-panel").modal("hide")};g.load=function(a){var c=b("#nerd-panel");console.log("Loading panel: "+a);this.show()};e={exec:function(a,b,c){d.document.execCommand(a,b,c);e.normalize()},normalize:function(){c.focused&&c.focused.normalize()},wrap:function(a){var c=b.range(),d=c.commonAncestorContainer,f=c.commonAncestorContainer.parentNode;if(f.nodeName===a.nodeName)return;b(f).find(a.nodeName).each(function(){var a=b(this);a.replaceWith(a.html())});c.surroundContents(a);e.normalize()},anchor:function(){var a=prompt("What do we call it?");if(a===null)return;e.exec("createbookmark",false,a)},block:function(){var a=prompt("What kind of block?");if(a===null)return;e.exec("formatblock",false,a)},bold:function(){var a=d.document.createElement("strong");e.wrap(a)},clear:function(){e.exec("delete")},clearanchor:function(){e.exec("unbookmark")},clearformat:function(){e.exec("removeformat")},clearlink:function(){e.exec("unlink")},copy:function(){e.exec("copy")},cut:function(){e.exec("cut")},hr:function(){e.exec("inserthorizontalrule")},image:function(){var a=prompt("Where is the image?");if(a===null)return;e.exec("insertimage")},indent:function(){e.exec("indent")},italic:function(){var a=d.document.createElement("em");e.wrap(a)},justifyleft:function(){e.exec("justifyleft")},justifycenter:function(){e.exec("justifycenter")},justifyright:function(){e.exec("justifyright")},link:function(){var a=prompt("Where do we point the link to?");if(a===null)return;e.exec("createlink",false,a)},ol:function(){e.exec("insertorderedlist")},outdent:function(){e.exec("outdent")},paste:function(){e.exec("paste")},print:function(){c.deactivate();e.exec("print");setTimeout(c.activate,1500)},source:function(){alert("Show HTML Source")},sub:function(){var a=d.document.createElement("sub");e.wrap(a)},sup:function(){var a=d.document.createElement("sup");e.wrap(a)},strike:function(){var a=d.document.createElement("del");e.wrap(a)},ul:function(){e.exec("insertunorderedlist")},underline:function(){var a=d.document.createElement("u");e.wrap(a)},undo:function(){e.exec("undo")}};var h=Nerd.handlers;for(var i in h){e[i]=h[i]}return Nerd})(window,$)